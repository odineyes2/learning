# mysql - sequelize.md

- 시퀄라이즈는 ORM(Object Relational Mapping) 이다.
- 자바스크립트 객체와 데이터베이스 릴레이션을 매핑해 주는 도구이다.
- 자바스크립트 구문을 알아서 sql 로 바꿔준다.

## 프로젝트 생성 및 초기 설정

- $ npm init
- $ npm i express morgan nunjucks sequelize sequelize-cli mysql2
- $ npm i -D nodemon

- mysql2 는 mysql과 시퀄라이즈를 이어주는 드라이버이다.

- $ npx sequelize init
- models 폴더안에 index.js가 생성되었는지 확인한다.

```javascript | index.js

const Sequelize = require('sequelize');

const env = process.env.NODE_ENV || 'development';
const config = require('../config/config')[env];
const db = {};

const squelize = new Sequelize(config.database, config.username, config.password, config);
db.sequelize = squelize;

module.exports = db;
```

- Sequelize 는 시퀄라이즈 패키지이자 생성자이다.
- config/config.json에서 데이터베이스 설정을 불러온 후
- new Sequelize 를 통해 mysql 연결 객체를 생성한다.
- 연결 객체를 나중에 재사용하기 위해 db.sequelize에 넣어둔다.

## mysql 연결하기

- 익스프레스 앱과 mysql 앱 연결하기

```javascript | app.js

const express = require('express');
const path = require('path');
const morgan = require('morgan');
const nunjucks = require('nunjucks');

const { sequelize } = require('./models');

const app = express();
app.set('port', process.env.PORT || 3001 );
app.set('view engine', 'html');

sequelize.sync({force:false}) // 서버 실행 시마다 테이블 재생성하지 않음
    .then(()=>{
        console.log('데이터베이스 연결 성공');
    })
    .catch((err)=>{
        console.error(err);
    });

app.use(morgan('dev'));
app.use(express.static(path.join(__dirname, 'public')));
app.use(express.json());
app.use(express.urlencoded({extended: false}));

app.use((req,res,next)=>{
    const err = new Error(`${req.method} ${req.url} 라우터가 없습니다.`);
    error.status = 404;
    next(error);
});

app.use((err,req,res,next)=>{
    res.locals.message = err.message;
    res.locals.error = procees.env.NODE_END !== 'production' ? err : {};
    res.status(err.status || 500);
    res.render('error');
})

app.listen(app.get('port'), ()=>{
    console.log(app.get('port'),'번 포트에서 대기중...');
})
```

## 모델 정의하기

- mysql 에서 정의한 테이블을 시퀄라이즈에서도 정의해야 한다.

```javascript | models/user.js

const Sequelize = require('sequelize');

class User extends Sequelize.Model {
    static initiate(sequelize) {
        User.init({
            name: {
                type: Sequelize.STRING(20),
                allowNull: false,
                unique: true,
            },
            age: {
                type: Sequelize.INTEGER.UNSIGNED,
                allowNull: false,                
            },
            married: {
                types: Sequeluze.BOOLEAN,
                allowNull: false,
            },
            comment: {
                type: Sequelize.TEXT,
                allowNull: true,
            },
            created_at: {
                type: Sequelize.DATE,
                allowNull: false,
                defaultValue: Sequelize.NOW,
            }, {
                sequelize,
                timestamps: false,
                underscored: false,
                modelName: 'User',
                tableName: 'user',
                paranoid: false,
                charset: 'utf-8',
                collate: 'utf8_general_ci',
            }
        });
    }
    statuc associate(db){}
};

module.exports = User;

```

## 관계 정의하기

## 쿼리 알아보기

## 쿼리 수행하기